<head>
  <meta charset="utf-8">
  <title>Civboot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles.css">
</head>
<nav>
  <ul>
    <a href="../index.html"   class="nav"             >civ/</a>
    <a href="index.html"      class="nav nav-selected">lua/</a>
  </ul>
</nav>

<!DOCTYPE html>
<html>
<body><div class=doc>
This is Civboot's VT100 terminal interface library. It implements (and also
defines) the API that civboot terminal emulators must implement to be
considered Civboot compliant.
<p>
It has the following core types and constants: <ul>
  <li><span class=code>Term</span> object, see below</li>
  <li><span class=code>AsciiColor</span> which is a map from single ascii lowercase characters to the
  color name (i.e. <span class=code>w -&gt; white</span>). These can be used in Term.fg and Term.bg to
  set the relvant colors.</li>
  <li><span class=code>FgColor</span> and <span class=code>BgColor</span> contains a map from the color name to the VT100 color
  code (for external libraries).</li>
  <li>Various key utility functions and maps for checking and working with the
  values sent by <span class=code>Term:input()</span></li>
</ul>
<p>
To be civboot compliant the <span class=code>Term</span> type exported must have the following API: <ul>
  <li><span class=code>ds.Grid</span> fields <span class=code>text, fg, bg</span> for terminal text, foreground color and
  background color respectively</li>
  <li><span class=code>l, c</span> fields for setting the cursor location (which is drawn)</li>
  <li><span class=code>h, w</span> (height width) fields (see <span class=code>resize()</span>)</li>
  <li><span class=code>:input(keysend)</span> method which asyncronously (LAP) sends any user-inputed keys</li>
  <li><span class=code>:draw()</span> method which draws the text</li>
  <li><span class=code>:resize()</span> method that (if nothing is passed to it) retrieves the <span class=code>h, w</span>
  fields and updates and clears child grids.</li>
  <li><span class=code>:clear()</span> method which clears all child grids.</li>
  <li><span class=code>run</span> boolean (default=true) which can be set to false to stop related
  coroutines (best effort)</li>
</ul>
<p>
<p>
<h1><a id=""vt100"" href="#"vt100"">Mod vt100</h1></a>
Civboot vt100 Terminal library that supports LAP protocol.
Module for interacting with the vt100 via keys and AsciiColors.
<div class=code-block>License CC0 / UNLICENSE<br>
Originally written 2022 Phil Leblanc, modified 2023 Rett Berg (Civboot.org)<br>
Authorized for relicense in: http://github.com/philanc/plterm/issues/4
</div>
<p>
<b>Types</b> <ul>
  <li><b>vt100.ctrl</b></li>
  <li><b>vt100.Term</b></li>
</ul>
<p>
<b>Functions</b> <ul>
  <li><span class=code>key()</span></li>
  <li><span class=code>ctrlChar()</span></li>
  <li><span class=code>literal(key) -&gt; literalstring?</span>
  Convert any key to it's literal form <div class=code-block>&nbsp; &nbsp; literal'a' &nbsp; &nbsp; &nbsp; -&gt; 'a'<br>
&nbsp; &nbsp; literal'enter' &nbsp; -&gt; '\n'<br>
&nbsp; &nbsp; literal'esc' &nbsp; &nbsp; -&gt; nil<br>
&nbsp; 
</div></li>
  <li><span class=code>keyError(key) -&gt; errstring?</span>
  Check that a key is valid. Return errstring if not.</li>
  <li><span class=code>checkKey(key) -&gt; key?, errstring?</span></li>
  <li><span class=code>colorFB(f, fg, bg, fg0, bg0)</span>
  Set the color, taking into account the previous color</li>
  <li><span class=code>acwrite(f, colorFB, fg, bg, fgstr, bgstr, str, ...)</span>
  write to the terminal-like file f using colors fgstr and bgstr
  accounting for previous color codes fg, bg
  
  Additional strings (...) are written using plain color.
  
  Return: <span class=code>fg, bg, write(str, ...)</span>
  <div class=info> Note: fg and bg are the updated color codes</div></li>
  <li><span class=code>setrawmode()</span></li>
  <li><span class=code>setsanemode() -&gt; os.execute'stty sane'</span></li>
  <li><span class=code>savemode() -&gt; mode?, errmsg?</span></li>
  <li><span class=code>restoremode(mode) -&gt; os.execute('stty '..mode)</span></li>
  <li><span class=code>start() -&gt; savedmode</span></li>
  <li><span class=code>stop(fd, savedmode)</span></li>
  <li><span class=code>Fmt(t)</span>
  create a Fmt with sensible defaults from the config</li>
  <li><span class=code>main(args)</span>
  Listens to keyboard inputs and echoes them.</li>
  <li><span class=code>setup(args)</span>
  The recommended setup function, enables color in the terminal in civstack
  libraries (and those that adhere to them).</li>
</ul>
<p>
<h2><a id=""vt100.ctrl"" href="#"vt100.ctrl"">Mod vt100.ctrl</h2></a>
Direct terminal control functions
<p>
<b>Functions</b> <ul>
  <li><span class=code>getlc(name, fmt)</span></li>
  <li><span class=code>color(name, fmt)</span></li>
  <li><span class=code>left(name, fmt)</span></li>
  <li><span class=code>clear(name, fmt)</span></li>
  <li><span class=code>reset(name, fmt)</span></li>
  <li><span class=code>restore(name, fmt)</span></li>
  <li><span class=code>right(name, fmt)</span></li>
  <li><span class=code>up(name, fmt)</span></li>
  <li><span class=code>save(name, fmt)</span></li>
  <li><span class=code>colorFB(name, fmt)</span></li>
  <li><span class=code>nextline(name, fmt)</span></li>
  <li><span class=code>down(name, fmt)</span></li>
  <li><span class=code>hide(name, fmt)</span></li>
  <li><span class=code>golc(name, fmt)</span></li>
  <li><span class=code>cleareol(name, fmt)</span></li>
  <li><span class=code>show(name, fmt)</span></li>
  <li><span class=code>size(f)</span>
  causes terminal to send size as (escaped) cursor position</li>
</ul>
<p>
<h2><a id=""vt100.Term"" href="#"vt100.Term"">Record Term</h2></a>
<ul>
  <li><b>fd</b> :
  file to write output to in draw()</li>
  <li><b>l</b> :
  cursor line</li>
  <li><b>c</b> :
  cursor column</li>
  <li><b>h</b> :
  height</li>
  <li><b>w</b> :
  width</li>
  <li><b>text</b> :
  the text to display</li>
  <li><b>fg</b> :
  foreground color (ASCII coded)</li>
  <li><b>bg</b> :
  background color (ASCII coded)</li>
  <li><b>run</b> :
  set to false to stop coroutines</li>
  <li><b>styler</b> :
  optional styler</li>
</ul>
VT100 Terminal Emulator <ul>
  <li>Write the text to display</li>
  <li>Write the foreground/background colors to fg/bg</li>
  <li>Then call :draw() to draw to terminal.</li>
</ul>
<p>
Requires <span class=code>vt100.start()</span> have been called to initiate raw mode.
<p>
<h1><a id=""Ty<vt100.AcWriter>"" href="#"Ty<vt100.AcWriter>"">Record vt100.AcWriter</h1></a>
<ul>
  <li><b>f</b> </li>
  <li><b>fg</b> :
  current foreground ac letter</li>
  <li><b>bg</b> :
  current background ac letter</li>
</ul>
<p>
<h1><a id=""vt100.testing"" href="#"vt100.testing"">Mod vt100.testing</h1></a>
helpers for testing/demoing vt100
<p>
<b>Types</b> <ul>
  <li><b>vt100.testing.Fake</b></li>
</ul>
<p>
<b>Functions</b> <ul>
  <li><span class=code>startTmp() -&gt; out, err</span>
  start rawmode using tmpfiles</li>
  <li><span class=code>run(fn)</span>
  Run function in a LAP environment with terminal started
  and std in/out set correctly.</li>
</ul>
<p>
<h2><a id=""vt100.testing.Fake"" href="#"vt100.testing.Fake"">Record Fake</h2></a>
<ul>
  <li><b>fd</b> :
  file to write output to in draw()</li>
  <li><b>l</b> :
  cursor line</li>
  <li><b>c</b> :
  cursor column</li>
  <li><b>h</b> :
  height</li>
  <li><b>w</b> :
  width</li>
  <li><b>text</b> :
  the text to display</li>
  <li><b>fg</b> :
  foreground color (ASCII coded)</li>
  <li><b>bg</b> :
  background color (ASCII coded)</li>
  <li><b>run</b> :
  set to false to stop coroutines</li>
  <li><b>styler</b> :
  optional styler</li>
</ul>
<p>
</div></body>
</html>
