<head>
  <meta charset="utf-8">
  <title>Civboot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles.css">
</head>
<nav>
  <ul>
    <a href="../index.html"   class="nav"             >civ/</a>
    <a href="index.html"      class="nav nav-selected">lua/</a>
  </ul>
</nav>

<!DOCTYPE html>
<html>
<body><div class=doc>
<h1>cxt: text markup for civilization</h1>
<br>
It should not take more than a few minutes to know how to read and write
documentation.
<br>
cxt is an ultra-simple markup language which is designed to be as easy as
possible to parse (for computers <i>and</i> humans) while still using as few
characters as possible to express format for common cases. The <span class=code>src/</span>
dir of <a href="code.commonmark.org">CommonMark</a> contains more than 20,000 lines of
code whereas cxt is implemented in less than 500.
<br>
cxt is designed to: <ul>
  <li>Make document writing easy: use relatively few characters to express
  common formatting</li>
  <li>Make document parsing easy: unambiguous, unlike <span class=code>Ma**rk_do*wn</span></li>
  <li>Readable as raw text</li>
  <li>structured data can be consumed: supports arbitrary attributes</li>
</ul>
<br>
CXT contains only three special characters for deliniating formatting controls: <ul>
  <li>the two bracket characters <span class=code>[]</span></li>
  <li>a way to escape brackets and itself <span class=code>\\</span>, <span class=code>\[</span> and <span class=code>\]</span></li>
</ul>
<br>
There are two ways to specify attributes for a block: <ul>
  <li>short: <span class=code>[*bold text]</span> where <span class=code>*</span> can be any of the shortcuts below</li>
  <li>full: <span class=code>[{*_ attr1 attr2=value}bold underlined with attr 1 and 2]</span></li>
</ul>
<br>
The following attributes and shortcuts are supported
<div class=code-block>&nbsp; b i u &nbsp; bold (*), italic (,) and underlined (_)<br>
&nbsp; * , _ &nbsp; Example: [*bold] [,italic] [_underlined]<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[{*,_}bold italic and underlined]<br>
<br>
&nbsp; code &nbsp; &nbsp;inline or block code (depending on whether newlines exist)<br>
&nbsp; &nbsp;$ &nbsp; &nbsp; &nbsp;shortcut: [$inline code]<br>
&nbsp; &nbsp;$$... &nbsp;shortcut: [$$inline code]$ &nbsp;(close is one less than open)<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Can also use inside {} to require extra $ to close:<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{$$ code=html}<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;b&gt;example html&lt;/b&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]$<br>
<br>
&nbsp; quote &nbsp; create a quote block<br>
&nbsp; &nbsp;" &nbsp; &nbsp; &nbsp;Example: ["quote block]<br>
<br>
&nbsp; list &nbsp; &nbsp;list syntax, see demos<br>
&nbsp; &nbsp;+ &nbsp; &nbsp; &nbsp;Example: [+<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * list item 1<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * list item 2<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]<br>
<br>
&nbsp; table &nbsp; table syntax, see demos.<br>
&nbsp; # head &nbsp;modify the delimiters with row/col/head attrs.<br>
&nbsp; + row<br>
&nbsp; | col<br>
<br>
&nbsp; hidden &nbsp;hidden block, used for comments and/or assigning attributes<br>
&nbsp; &nbsp;! &nbsp; &nbsp; &nbsp;Example: [!hidden block]<br>
<br>
&nbsp; href &nbsp; &nbsp;hyper reference, aka a url.<br>
&nbsp; &lt;href&gt;<br>
<br>
&nbsp; &nbsp;path &nbsp; a path, typically relative to project or website root.<br>
&nbsp; &nbsp; / &nbsp; &nbsp; Example: [/path/to/file.lua]<br>
<br>
&nbsp; name &nbsp; &nbsp;sets the name of the block.<br>
&nbsp; &nbsp;n &nbsp; &nbsp; &nbsp;Used with: [@name] &nbsp;href=#name &nbsp;anyAttr=@name<br>
&nbsp; &nbsp;: &nbsp; &nbsp; &nbsp;shortcut: [{: ...}name]<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Example: [{name=Civboot href=http://civboot.org}Civboot]<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Example: [{: href=http://civboot.org}Civboot]<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; You can link to the named item with [&lt;#name&gt;link to name].<br>
<br>
&nbsp; value &nbsp; when @ is used for an attr value, it will get this attribute.<br>
&nbsp; &nbsp;v &nbsp; &nbsp; &nbsp;defaults to "href" if the node has one, else "text" which<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is the node's text.<br>
<br>
&nbsp; &nbsp;@ &nbsp; &nbsp; &nbsp;copies a block with given name. When used as an attr value<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; it gets the attribute referenced by "value"<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Example:<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{!:href=http://civboot.org}Civboot] creates a hidden named block<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [@Civboot] clones the block (removing name and hidden)<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [&lt;@Civboot&gt;Civboot Project] has href=http://civboot.org<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; note: the default for "value" is "href" if it exists.<br>
<br>
&nbsp;escapes<br>
&nbsp; &nbsp;\[ &nbsp; &nbsp;literal [<br>
&nbsp; &nbsp;\] &nbsp; &nbsp;literal ]<br>
&nbsp; &nbsp;\\ &nbsp; &nbsp;literal \<br>
&nbsp; &nbsp;\* &nbsp; &nbsp;literal \*, where * is any other character
</div>
<br>
<div class=info> Note:
Any value after a bracket besides <span class=code>&nbsp;{...} b i u * , _ $ " + ! / : v @ </span>
is invalid.
</div>
<br>
<h2><a id="Demos" href="#Demos" class=anchor>Demos</h2></a>
<br>
<h3>Inline Code:</h3>
<br>
<span class=code>[$inline code]. Note that [$$ [brackets] need ]$</span>
<ul>
  <li><span class=code>inline code</span>. Note that <span class=code>&nbsp;[brackets] need </span></li>
</ul>
<br>
<div class=info>The number of $ at the end of a code block is one less
than the number used to open it.
</div>
<br>
<h3>Code block:</h3>
<br>
Writing this: <div class=code-block>[{$$ lang=lua}<br>
function example()<br>
&nbsp; print'Hello world'<br>
end<br>
]$
</div>
<br>
Will create a formatted code block: <div class=code-block>function example()<br>
&nbsp; print'Hello world'<br>
end
</div>
<br>
<h3>Text Formatting</h3>
<span class=code>[*bold], [,italic] and [_underlined]</span> <ul>
  <li><b>bold</b>, <i>italic</i> and <u>underlined</u></li>
</ul>
<br>
<h3>Linking</h3>
<span class=code>[{b i href=http://civboot.org}bold italic link]</span> <ul>
  <li><a href="http://civboot.org"><b><i>bold italic link</i></b></a></li>
</ul>
<br>
<h3>List</h3>
Lists are started with <span class=code>+</span>, each items is deliniated by <span class=code>*</span>: <div class=code-block>A list of stuff: [+<br>
* example list<br>
* with sub list:[+<br>
&nbsp; * sub item<br>
&nbsp; * multi-line<br>
<br>
&nbsp; &nbsp; sub item.<br>
&nbsp; * inner code block<br>
&nbsp; &nbsp; [$$<br>
&nbsp; &nbsp; function example()<br>
&nbsp; &nbsp; &nbsp; print'example inner block'<br>
&nbsp; &nbsp; end<br>
&nbsp; &nbsp; ]$<br>
&nbsp; * final sub<br>
]<br>
* final item<br>
]
</div>
<br>
A list of stuff: <ul>
  <li>example list</li>
  <li>with sub list:<ul>
    <li>sub item</li>
    <li>multi-line
    <br>
    sub item.</li>
    <li>inner code block
    <div class=code-block>function example()<br>
&nbsp; print'example inner block'<br>
end
</div></li>
    <li>final sub</li>
  </ul></li>
  <li>final item</li>
</ul>
<br>
<h3>Hidden</h3>
<span class=code>Hidden block: "[! this is hidden]"</span> <ul>
  <li>Hidden block: ""</li>
</ul>
<br>
<h3>Table</h3>
A table is created by the 'table' attribute. We also set the <span class=code>head</span>, <span class=code>row</span>
and <span class=code>col</span> to the defaults for demonstration (they can be excluded). The
<span class=code>row</span> and <span class=code>head</span> deliminters are only recognized at the start of a line.
<br>
<div class=code-block>A table: [{table head=# row=+ col=|}<br>
# col 1 &nbsp; &nbsp; &nbsp;| col 2 &nbsp; | col 3<br>
+ row [*1.1] | row 1.2 | row 1.3<br>
+ row [*1.1] | row 1.2 | row 1.3<br>
]
</div>
<br>
A table: <div class=table><table>
  <tr>
    <th>col 1</th>
    <th>col 2</th>
    <th>col 3</th>
  </tr>
  <tr>
    <td>row <b>1.1</b></td>
    <td>row 1.2</td>
    <td>row 1.3</td>
  </tr>
  <tr>
    <td>row <b>1.1</b></td>
    <td>row 1.2</td>
    <td>row 1.3</td>
  </tr>
</table></div>
<br>
<h3>Table with large columns</h3>
For very large or multi-lined columns, you can organize them similar to
sub-lists: <div class=code-block>[{table}<br>
# 1st header column<br>
| 2nd header column<br>
| 3rd header column<br>
+ long row 1.1<br>
| long row 1.2<br>
<br>
&nbsp; Even includes new line!<br>
| long row 1.3<br>
&nbsp; [{$$ code=lua}<br>
&nbsp; function example()<br>
&nbsp; &nbsp; return "code block"<br>
&nbsp; end<br>
&nbsp; ]$<br>
+ row 2.1<br>
| row 2.2<br>
| row 2.3<br>
]
</div>
<br>
<div class=table><table>
  <tr>
    <th>1st header column
    </th>
    <th>2nd header column
    </th>
    <th>3rd header column</th>
  </tr>
  <tr>
    <td>long row 1.1
    </td>
    <td>long row 1.2
    <br>
    Even includes new line!
    </td>
    <td>long row 1.3
    <div class=code-block>function example()<br>
&nbsp; return "code block"<br>
end
</div></td>
  </tr>
  <tr>
    <td>row 2.1
    </td>
    <td>row 2.2
    </td>
    <td>row 2.3</td>
  </tr>
</table></div>
<br>
<h3>Named Nodes and Values</h3>
<div class=info> <b>Note</b>: all visible named blocks have a ‚òç link next to them and serve dual
purpose of being referenced within the cxt file using <span class=code>[@name]</span> and by
local and external links (<span class=code>href=#name</span>) </div>
<br>
<span class=code>A hidden named block: "[{!:href=http://civboot.org}Civboot]"</span> <ul>
  <li>A hidden named block: ""</li>
</ul>
<br>
<div class=code-block>A visible named block: [{:href=https://github.com/civboot/civstack}civstack]] [+<br>
* A visible named block: [{:href=https://github.com/civboot/civstack}civstack]
</div>
<br>
<div class=code-block>[@Civboot] clones the hidden block (removing the [$clone] attribute)] [+<br>
* [@Civboot] clones the hidden block (removing the [$clone] attribute)
</div>
<br>
<div class=code-block>[&lt;@Civboot&gt;Civboot Project] has [$href=http://civboot.org].][+<br>
* [&lt;@Civboot&gt;Civboot Project] has [$href=http://civboot.org].
</div>
<br>
<div class=code-block>You can also link to named blocks with [$href=#name], for instance the "Demos"<br>
header is named [&lt;#Demos&gt;Demos].
</div> <ul>
  <li>You can also link to named blocks with <span class=code>href=#name</span>, for instance the "Demos"
  header is named <a href="#Demos">Demos</a>.</li>
</ul>
<br>
<h3>Escaping [brackets]</h3>
<div class=code-block>You can \[escape\] brackets to render them directly.<br>
You can also escape '\\'.
</div> <ul>
  <li>You can [escape] brackets to render them directly.
  You can also escape '\'.</li>
</ul>
<br>
<h2>UNLICENSE</h2>
Cxt is in the the public domain, see the <a href="../UNLICENSE">UNLICENSE</a> for details.
<br>
It was originally created by Rett Berg as part of the <a href="http://civboot.org">Civboot</a> project.
<br>
<h3><a id="cxt" href="#cxt" class=anchor>Command cxt</h3></a>
TODO: see TODO.cxt
<h4><a id="html" href="#html" class=anchor>Subcmd html</h4></a>
Convert cxt to HTML.
<b>Arguments:</b><ul>
  <li><a id="html.to" href="#html.to" class=anchor><b>to</b></a>
  where to write output.</li>
</ul>
<br>
<b>Types: </b><a href="#cxt.Config">Config</a> <a href="#cxt.Writer">Writer</a> 
<br>
<b>Functions</b> <ul>
  <li><a id="cxt.escape" href="#cxt.escape" class=anchor><b>fn escape</b></a><span class=code>(str) -&gt; str:gsub('([\\%[%]])', '\\%1')</span><br>
  
  escape the string so it renders literally</li>
  <li><a id="cxt.code" href="#cxt.code" class=anchor><b>fn code</b></a><span class=code>(str, lang)</span><br>
  
  create <span class=code>&nbsp;[$inline code] </span></li>
  <li><a id="cxt.content" href="#cxt.content" class=anchor><b>fn content</b></a><span class=code>(p, node, isRoot, altEnd)</span><br>
  
  parse normal content, adding to node
  p is a <span class=code>pegl.Parser</span>. isRoot indicates
  it is currently parsing plain text.</li>
  <li><a id="cxt.parse" href="#cxt.parse" class=anchor><b>fn parse</b></a><span class=code>(dat, dbg, path)</span><br>
  
  Main parsing entry point.</li>
  <li><a id="cxt.checkParse" href="#cxt.checkParse" class=anchor><b>fn checkParse</b></a><span class=code>(dat, context) -&gt; dat</span></li>
  <li><a id="cxt.parsedStrings" href="#cxt.parsedStrings" class=anchor><b>fn parsedStrings</b></a><span class=code>(p, node)</span></li>
  <li><a id="cxt.assertParse" href="#cxt.assertParse" class=anchor><b>fn assertParse</b></a><span class=code>(dat, expected, dbg) -&gt; node</span></li>
  <li><a id="cxt.assertThrows" href="#cxt.assertThrows" class=anchor><b>fn assertThrows</b></a><span class=code>(dat, err, dbg)</span></li>
</ul>
<br>
<h4><a id="cxt.Config" href="#cxt.Config" class=anchor>Record Config</h4></a>
<b>Fields:</b><ul>
  <li><a id="cxt.Config.header" href="#cxt.Config.header" class=anchor><b>header</b></a>
  typically used for html header</li>
  <li><a id="cxt.Config.pathUrl" href="#cxt.Config.pathUrl" class=anchor><b>pathUrl</b></a> <span class=code>=ds.iden</span></li>
</ul>
<br>
<h4><a id="cxt.Writer" href="#cxt.Writer" class=anchor>Record Writer</h4></a>
A Writer for cxt serializers (terminal, http, etc) to use.
<br>
The writer contains: <ul>
  <li>The src lines and token decoder for getting pegl.Token values.</li>
  <li>The destination lines and current indent level.</li>
</ul>
<br>
<b>Fields:</b><ul>
  <li><a id="cxt.Writer.src" href="#cxt.Writer.src" class=anchor><b>src</b></a></li>
  <li><a id="cxt.Writer.to" href="#cxt.Writer.to" class=anchor><b>to</b></a></li>
  <li><a id="cxt.Writer.config" href="#cxt.Writer.config" class=anchor><b>config</b></a> <span class=code>=Config() instance</span></li>
</ul>
<b>Methods</b> <ul>
  <li><a id="Writer.fromParser" href="#Writer.fromParser" class=anchor><b>fn fromParser</b></a><span class=code>(ty_, p, to)</span></li>
  <li><a id="Writer.tokenStr" href="#Writer.tokenStr" class=anchor><b>fn tokenStr</b></a><span class=code>(w, t)</span></li>
  <li><a id="Writer.eqStr" href="#Writer.eqStr" class=anchor><b>fn eqStr</b></a><span class=code>(w, t, str)</span></li>
  <li><a id="Writer.level" href="#Writer.level" class=anchor><b>fn level</b></a><span class=code>(w, add) -&gt; w.to:level(add)</span></li>
</ul>
<br>
<h3><a id="cxt.term" href="#cxt.term" class=anchor>Mod cxt.term</h3></a>
cxt for the terminal, either plain text or vt100/etc
<br>
<br>
<b>Types: </b><a href="#cxt.term.Args">Args</a> 
<br>
<b>Functions</b> <ul>
  <li><a id="cxt.term.serialize" href="#cxt.term.serialize" class=anchor><b>fn serialize</b></a><span class=code>(w, node)</span></li>
  <li><a id="cxt.term.convert" href="#cxt.term.convert" class=anchor><b>fn convert</b></a><span class=code>(dat, to)</span></li>
  <li><a id="cxt.term.main" href="#cxt.term.main" class=anchor><b>fn main</b></a><span class=code>(args)</span></li>
</ul>
<br>
<h4><a id="cxt.term.Args" href="#cxt.term.Args" class=anchor>Record Args</h4></a>
Render cxt on a terminal.
<br>
Will render an input string or --inp=file.
<br>
<b>Fields:</b><ul>
  <li><a id="cxt.term.Args.inp" href="#cxt.term.Args.inp" class=anchor><b>inp</b></a>
  input file</li>
  <li><a id="cxt.term.Args.out" href="#cxt.term.Args.out" class=anchor><b>out</b></a>
  output file (default=stdout)</li>
</ul>
<br>
<h4><a id="html" href="#html" class=anchor>Command html</h4></a>
Convert cxt to HTML.
<b>Arguments:</b><ul>
  <li><a id="html.to" href="#html.to" class=anchor><b>to</b></a>
  where to write output.</li>
</ul>
<br>
</div></body>
</html>
