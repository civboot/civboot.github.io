<head>
  <meta charset="utf-8">
  <title>Civboot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles.css">
</head>
<nav>
  <ul>
    <a href="../index.html"   class="nav"             >civ/</a>
    <a href="index.html"      class="nav nav-selected">lua/</a>
  </ul>
</nav>

<!DOCTYPE html>
<html>
<body><div class=doc>
<b>ds</b>: absurdly necessary data structures and algorithms
<br>
ds is a small-ish lua library which fills many of the data structure and method
gaps (needed "batteries") in Lua's standard library. It's only dependency is
<a href="lib/metaty">lib/metaty</a> which it uses for defining it's records and <a href="lib/fmt">lib/fmt</a> which it
uses to define the logging interface.
<br>
<h3>none: "set but none" vs nil's simply "unset"</h3>
In Lua <span class=code>nil</span> always means "unset". Certain APIs (like JSON) might distinguish
between unset vs null/empty/none. For such APIs <span class=code>none</span> can be used to mean "set
as none" instead of simply "unset" (which is what <span class=code>nil</span> means).
<br>
<span class=code>none</span> overrides <span class=code>__metatable='none'</span> so that <span class=code>getmetatable(none)=='none'</span> and
<span class=code>metaty.ty(none) == 'none'</span>.
<br>
<div class=info>WARNING: <span class=code>assert(none)</span> will pass.  Use <span class=code>ds.bool</span> to make <span class=code>none</span> falsy.</div>
<br>
<h3>path</h3>
<span class=code>ds.path</span> has some functions for working with paths.
<br>
It interacts (but does not set) the <b>globals</b> <span class=code>CWD</span> and <span class=code>HOME</span> to get the
"current working directory" and "home directory", respectively.
<br>
<br>
<h1><a id="ds" href="#ds" class=anchor>Mod ds</h1></a>
ds: data structures and algorithms.
<br>
<b>Types: </b><a href="#ds.B">B</a> <a href="#ds.PlainStyler">PlainStyler</a> <a href="#ds.TypoSafe">TypoSafe</a> <a href="#ds.Slc">Slc</a> <a href="#ds.Imm">Imm</a> <a href="#ds.Duration">Duration</a> <a href="#ds.Epoch">Epoch</a> <a href="#ds.Set">Set</a> <a href="#ds.bt">bt</a> <a href="#ds.BiMap">BiMap</a> <a href="#ds.Deq">Deq</a> <a href="#ds.TWriter">TWriter</a> <a href="#ds.Error">Error</a> 
<br>
<b>Functions</b> <ul>
  <li><a id="ds.setup" href="#ds.setup" class=anchor><b>fn setup</b></a><span class=code>(args)</span><br>
  
  Default LUA_SETUP, though vt100 is recommended for most users.</li>
  <li><a id="ds.concat" href="#ds.concat" class=anchor><b>fn concat</b></a><span class=code>(sep, ...) -&gt; string</span><br>
  
  concatenate the string arguments.</li>
  <li><a id="ds.push" href="#ds.push" class=anchor><b>fn push</b></a><span class=code>(t, v) -&gt; index</span><br>
  
  push the value onto the end of the table, return the index.</li>
  <li><a id="ds.name" href="#ds.name" class=anchor><b>fn name</b></a><span class=code>(t) -&gt; string</span><br>
  
  if t is a table returns t.__name or '?'</li>
  <li><a id="ds.inset" href="#ds.inset" class=anchor><b>fn inset</b></a><span class=code>(t, i, values, rmlen) -&gt; nil</span><br>
  
  insert values into list at index i.
  Uses <span class=code>inset</span> method if available.
  rmlen, if provided, will cause <span class=code>t[i:i+rmlen</span></li>
</ul> to be removed first

inset is like an extend but the items are insert at any place in the array.
The rmlen will also remove a certain number of items.
* <a id="ds.isPod" href="#ds.isPod" class=anchor><b>fn isPod</b></a>
* <a id="ds.noop" href="#ds.noop" class=anchor><b>fn noop</b></a><span class=code>()</span>
* <a id="ds.nosupport" href="#ds.nosupport" class=anchor><b>fn nosupport</b></a><span class=code>()</span>
* <a id="ds.iden" href="#ds.iden" class=anchor><b>fn iden</b></a><span class=code>(...) -&gt; ...</span>
* <a id="ds.retTrue" href="#ds.retTrue" class=anchor><b>fn retTrue</b></a><span class=code>() -&gt; true</span>
* <a id="ds.retFalse" href="#ds.retFalse" class=anchor><b>fn retFalse</b></a><span class=code>() -&gt; false</span>
* <a id="ds.newTable" href="#ds.newTable" class=anchor><b>fn newTable</b></a><span class=code>() -&gt; {}</span>
* <a id="ds.eq" href="#ds.eq" class=anchor><b>fn eq</b></a><span class=code>(a, b) -&gt; a == b</span>
* <a id="ds.srcloc" href="#ds.srcloc" class=anchor><b>fn srcloc</b></a><span class=code>(level) -&gt; "/path/to/dir/file.lua:10"</span>
* <a id="ds.shortloc" href="#ds.shortloc" class=anchor><b>fn shortloc</b></a><span class=code>(level) -&gt; "dir/file.lua:10"</span>
* <a id="ds.srcdir" href="#ds.srcdir" class=anchor><b>fn srcdir</b></a><span class=code>(level) -&gt; "/path/to/dir/"</span>
* <a id="ds.coroutineErrorMessage" href="#ds.coroutineErrorMessage" class=anchor><b>fn coroutineErrorMessage</b></a><span class=code>(cor, err) -&gt; string</span>
* <a id="ds.isWithin" href="#ds.isWithin" class=anchor><b>fn isWithin</b></a><span class=code>(v, min, max) -&gt; bool</span>
* <a id="ds.lt" href="#ds.lt" class=anchor><b>fn lt</b></a><span class=code>(a, b) -&gt; a &lt; b</span>
* <a id="ds.gt" href="#ds.gt" class=anchor><b>fn gt</b></a><span class=code>(a, b) -&gt; a &gt; b</span>
* <a id="ds.lte" href="#ds.lte" class=anchor><b>fn lte</b></a><span class=code>(a, b) -&gt; a &lt;= b</span>
* <a id="ds.bound" href="#ds.bound" class=anchor><b>fn bound</b></a><span class=code>(v, min, max) -&gt; value within [min,max]</span>
* <a id="ds.sort2" href="#ds.sort2" class=anchor><b>fn sort2</b></a><span class=code>(a, b) -&gt; (small, large)</span>
* <a id="ds.repr" href="#ds.repr" class=anchor><b>fn repr</b></a><span class=code>(v) -&gt; sfmt('%q', v)</span>
* <a id="ds.isEven" href="#ds.isEven" class=anchor><b>fn isEven</b></a><span class=code>(a) -&gt; bool</span>
* <a id="ds.isOdd" href="#ds.isOdd" class=anchor><b>fn isOdd</b></a><span class=code>(a) -&gt; bool</span>
* <a id="ds.decAbs" href="#ds.decAbs" class=anchor><b>fn decAbs</b></a><span class=code>(v) -&gt; number</span>
* <a id="ds.concat" href="#ds.concat" class=anchor><b>fn concat</b></a><span class=code>(sep, ...) -&gt; string</span><br>

concatenate the string arguments.
* <a id="ds.isupper" href="#ds.isupper" class=anchor><b>fn isupper</b></a><span class=code>(c) -&gt; string?</span><br>

return the string if it is only uppercase letters
* <a id="ds.islower" href="#ds.islower" class=anchor><b>fn islower</b></a><span class=code>(c) -&gt; string?</span><br>

return the string if it is only lowercase letters
* <a id="ds.trim" href="#ds.trim" class=anchor><b>fn trim</b></a><span class=code>(subj, pat, index) -&gt; string</span>
* <a id="ds.find" href="#ds.find" class=anchor><b>fn find</b></a><span class=code>(subj, pats, si, plain) -&gt; (ms, me, pi, pat)</span><br>

find any of a list of patterns. Return the match <span class=code>start, end</span> as well as
the <span class=code>index, pat</span> of the pattern matched.
* <a id="ds.split" href="#ds.split" class=anchor><b>fn split</b></a><span class=code>(subj, pat--[[%s+]], index--[[1]]) -&gt; (cxt, str) iter</span><br>

split the subj by pattern. <span class=code>ctx</span> has two keys: <span class=code>si</span> (start index) and
<span class=code>ei</span> (end index)
<div class=code-block>for ctx, line in split(text, '\n') do -- split lines<br>
&nbsp; ... do something with line<br>
end
</div>
* <a id="ds.splitList" href="#ds.splitList" class=anchor><b>fn splitList</b></a><span class=code>(...) -&gt; list</span>
* <a id="ds.trimEnd" href="#ds.trimEnd" class=anchor><b>fn trimEnd</b></a><span class=code>(subj, pat, index) -&gt; string</span><br>

trim the end of the string by removing pat (default='%s')
* <a id="ds.squash" href="#ds.squash" class=anchor><b>fn squash</b></a><span class=code>(s, repl) -&gt; string</span><br>

Squash a string: convert all whitespace to repl (default=' ').
* <a id="ds.usub" href="#ds.usub" class=anchor><b>fn usub</b></a><span class=code>(s, si, ei, len)</span><br>

utf8 sub. If len is pre-computed you can pass it in for better performance.
* <a id="ds.simplestr" href="#ds.simplestr" class=anchor><b>fn simplestr</b></a><span class=code>(s)</span><br>

A way to declare simpler mulitline strings which: <ul>
  <li>ignores the first/last newline if empty</li>
  <li>removes leading whitespace equal to the first
  line (or second line if first line has no indent)</li>
</ul>
Example: <div class=code-block>&nbsp; local s = require'ds'.simplestr<br>
&nbsp; local mystr = s[[<br>
&nbsp; &nbsp; this is<br>
&nbsp; &nbsp; &nbsp; a string.<br>
&nbsp; ]]<br>
&nbsp; T.eq('this is\n &nbsp;a string.', mystr)<br>
&nbsp; 
</div>
* <a id="ds.bin" href="#ds.bin" class=anchor><b>fn bin</b></a><span class=code>(uint, width--[[8]], sep4--[['_']]) -&gt; str</span><br>

Convert integer to binary representation (0's and 1's) <ul>
  <li>width will be the number of bits.</li>
  <li>sep4 will be used to separate every 4 bits, set to
  nil to disable.</li>
</ul>
* <a id="ds.get" href="#ds.get" class=anchor><b>fn get</b></a><span class=code>(t, k) -&gt; value</span><br>

<span class=code>t[k</span>
</div></body>
</html>
