<head>
  <meta charset="utf-8">
  <title>Civboot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles.css">
</head>
<nav>
  <ul>
    <a href="../index.html"   class="nav"             >civ/</a>
    <a href="index.html"      class="nav nav-selected">lua/</a>
  </ul>
</nav>

<!DOCTYPE html>
<html>
<body><div class=doc>
<h1>pod: plain-old-data library and serialization</h1>
<br>
A Lua library for specifying and converting types to/from "plain old data" and
methods to serialize/deserialize those types to/from bytes. In Lua, the 5
supported types considered "plain old data" are: nil, boolean, integer, string
and any table of only these types.
<br>
<div class=code-block>local M = mod'mymod'<br>
local mty = require'metaty'<br>
local pod = require'pod'<br>
<br>
-- enums are already plain-old-data.<br>
M.Job = mty.enum'Job' { BOSS = 1, PEON = 2 }<br>
<br>
--- records need to have pod() called on them.<br>
--- This implements __toPod and __fromPod for the metaty record.<br>
M.Worker = pod(mty'Worker' {<br>
&nbsp; 'name [string] #1', &nbsp; &nbsp;-- must specify type and #id<br>
&nbsp; 'job &nbsp;[mymod.Job] #2', -- can lookup any type in PKG_LOOKUP<br>
&nbsp; 'salary [int] #3',<br>
&nbsp; 'schedule {int: mymod.Schedule} #4', -- map of weekday[1,7] -&gt; scheduled time<br>
})<br>
<br>
M.Schedule = pod(mty'Schedule' {<br>
&nbsp; 'start [int]: start time in seconds since midnight',<br>
&nbsp; 'stop &nbsp;[int]: stop time in seconds since midnight',<br>
})<br>
<br>
local serialized = pod.ser(M.Worker{...}) &nbsp; -- convert to string<br>
local worker = pod.de(serialized, M.Worker) -- convert from string
</div>
<br>
Explanation of above:<ul>
  <li><span class=code>metaty.enum</span> are already plain-old-data (no need to call <span class=code>pod()</span> on them).</li>
  <li><span class=code>metaty</span> record types can be made plain old data by calling the
  <span class=code>pod()</span> module on them.
  <br>
  This simply implements the <span class=code>__toPod</span> and <span class=code>__fromPod</span> methods on them --
  you can do this yourself if you prefer!</li>
  <li>pod parses the metaty field type stanza as <span class=code>[singleType</span></li>
</ul>, <span class=code>{listType}</span> or
<span class=code>{map: type}</span> repsecitively. The collection types are converted to
<span class=code>pod.List</span> and <span class=code>pod.Map</span> respectively.
</div></body>
</html>
