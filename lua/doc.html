<head>
  <meta charset="utf-8">
  <title>Civboot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles.css">
</head>
<nav>
  <ul>
    <a href="../index.html"   class="nav"             >civ/</a>
    <a href="index.html"      class="nav nav-selected">lua/</a>
  </ul>
</nav>

<!DOCTYPE html>
<html>
<body><div class=doc>
Get documentation on any Lua object. Includes documentation for several items
in the lua stdlibrary.
<p>
<div class=info>Note: This requires the PKG protocol to be installed, see <a href="lib/pkg">lib/pkg</a></div>
<p>
Making a library's types self-documenting is easy:
<p>
<div class=code-block>local G = G or _G<br>
-- My module docs<br>
local M = G.mod and mod'myModName' or {}<br>
<br>
--- my fn docs in [$cxt]<br>
M.myFn = function(a, b) --&gt; string<br>
&nbsp; -- do stuff<br>
end
</div>
<p>
See Package_pkg and Package_cxt for more details.
<p>
<b>Other Resources</b> <ul>
  <li>Lua API reference: <a href="https://www.lua.org/manual">https://www.lua.org/manual</a></li>
  <li>Tutorial style documentation: <a href="https://www.lua.org/pil/contents.html">https://www.lua.org/pil/contents.html</a></li>
</ul>
<p>
<h1><a id=""doc"" href="#"doc"">Mod doc</h1></a>
Builds on metaty to add the ability to extract and format documentation.
<p>
Also offers the Cmd and Cmds types for documenting shell commands.
<p>
<b>Types</b> <ul>
  <li><b>doc.Doc</b></li>
  <li><b>doc.Main</b></li>
</ul>
<p>
<b>Functions</b> <ul>
  <li><span class=code>tryfind(obj) -&gt; any?</span>
  Find the object/name or return nil.</li>
  <li><span class=code>find(obj) -&gt; any</span>
  Find the object/name.</li>
</ul>
<p>
<h2><a id=""doc.Doc"" href="#"doc.Doc"">Record Doc</h2></a>
<ul>
  <li><b>to</b> :
  file to write to.</li>
  <li><b>indent</b> </li>
</ul>
Object passed to __doc methods.
Aids in writing cxt.
<p>
<h2><a id=""doc.Main"" href="#"doc.Main"">Record Main</h2></a>
<ul>
  <li><b>to</b> :
  where to write output.</li>
</ul>
Get cxt documentation for symbol.
<p>
<h1><a id=""doc.lua"" href="#"doc.lua"">Mod doc.lua</h1></a>
<p>
<b>Functions</b> <ul>
  <li><span class=code>keyword() -&gt; setmetatable({}, Keyword)</span></li>
  <li><span class=code>next(tbl, key) -&gt; nextKey</span>
  Get the next key in the table. Used for iterating through tables.
  If <span class=code>key=nil</span> returns the first key. Returns <span class=code>nil</span> when <span class=code>key</span> is
  the last key.</li>
  <li><span class=code>pcall(fn, ...) -&gt; ok, fn(...)</span>
  call a function but catch errors. Returns <span class=code>ok</span> followed by the function
  results. If not ok, returns the error.</li>
  <li><span class=code>select()</span>
  select elements in varargs <span class=code>...</span> at and after index.
  
  Special value: if <span class=code>index='#'</span> then returns length of <span class=code>...</span></li>
  <li><span class=code>type(val) -&gt; string</span>
  Get the type of <span class=code>val</span>. Possible return values are: <ul>
    <li>data: nil number string boolean table</li>
    <li>other: function thread userdata</li>
  </ul>
  <div class=info> See also: metaty.ty(v) for metatypes</div></li>
  <li><span class=code>setmetatable()</span>
  Sets the metatable on the table which can get gotten with
  <span class=code>getmetatable</span> and affects the behavior of operators.
  
  All metamethods: <div class=code-block>&nbsp; __index &nbsp; &nbsp;(i.e. t[k]) &nbsp; &nbsp; NOTE: these are only called<br>
&nbsp; __newindex (i.e. t[k] = v) &nbsp; &nbsp; &nbsp; when key is missing!<br>
&nbsp; <br>
&nbsp; __call &nbsp; &nbsp; (i.e. t())<br>
&nbsp; __tostring (i.e. tostring(t))<br>
&nbsp; <br>
&nbsp; + &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp; &nbsp; &nbsp;/ &nbsp; &nbsp; &nbsp; // &nbsp; &nbsp; &nbsp; &nbsp;%<br>
&nbsp; __add &nbsp; &nbsp; __sub &nbsp; &nbsp;__mul &nbsp; &nbsp;__div &nbsp; __idiv &nbsp; &nbsp;__mod<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __unm<br>
&nbsp; <br>
&nbsp; &amp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;~ &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; &nbsp; &nbsp; &nbsp;&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp;^<br>
&nbsp; __band &nbsp; &nbsp;__bor &nbsp; &nbsp;__bnot &nbsp; __shl &nbsp; __shr &nbsp; &nbsp; __pow<br>
&nbsp; <br>
&nbsp; == &nbsp; &nbsp; &nbsp; &nbsp;&lt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;= &nbsp; &nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; &nbsp;..<br>
&nbsp; __eq &nbsp; &nbsp; &nbsp;__lt &nbsp; &nbsp; __le &nbsp; &nbsp; __len &nbsp; &nbsp;__concat<br>
&nbsp; <br>
&nbsp; __name<br>
&nbsp; 
</div>
  
  <div class=info> See also metaty metamethods: __fields   __fmt</div></li>
  <li><span class=code>getmetatable(t) -&gt; mt</span>
  See setmetatable.</li>
  <li><span class=code>tostring(v) -&gt; string</span>
  Convert any value to a string by calling __tostring or using lua's default.</li>
  <li><span class=code>string.concat(sep, ...) -&gt; string</span>
  concatenate the string arguments.</li>
  <li><span class=code>string.find(subj, pat, index=1) -&gt; (si, ei, ...matches)</span>
  Find the pattern in the subj (subject) string, starting at the index.
  returns the si (start index), ei (end index) and match groups
  (see <a href="#string.match">#string.match</a>).
  
  <div class=code-block>T.eq({2, 4}, &nbsp; &nbsp; &nbsp; {find('%w+', ' bob is nice')})<br>
T.eq({2, 7, 'is'}, {find(' bob is nice', '%w+ (%w+)')})
</div>
  
  Character classes for matching specific sets: <div class=code-block>&nbsp; &nbsp; . &nbsp; all characters<br>
&nbsp; &nbsp; %a &nbsp;letters<br>
&nbsp; &nbsp; %c &nbsp;control characters<br>
&nbsp; &nbsp; %d &nbsp;digits<br>
&nbsp; &nbsp; %l &nbsp;lower case letters<br>
&nbsp; &nbsp; %p &nbsp;punctuation characters<br>
&nbsp; &nbsp; %s &nbsp;space characters<br>
&nbsp; &nbsp; %u &nbsp;upper case letters<br>
&nbsp; &nbsp; %w &nbsp;alphanumeric characters<br>
&nbsp; &nbsp; %x &nbsp;hexadecimal digits<br>
&nbsp; &nbsp; %z &nbsp;the character with representation 0<br>
&nbsp; 
</div>
  
  Magic characters, <span class=code>.</span> indicates one character, more indicates many
  <div class=code-block>&nbsp; %. &nbsp; &nbsp; selects a character class or escapes a magic char<br>
&nbsp; (...) &nbsp;create a group<br>
&nbsp; [...] &nbsp;create your own character class<br>
&nbsp; [^..] &nbsp;inversion of [...]<br>
&nbsp; +. &nbsp; &nbsp; match one or more of previous class &nbsp;(NOT group)<br>
&nbsp; *. &nbsp; &nbsp; match zero or more of previous class (NOT group)<br>
&nbsp; ? &nbsp; &nbsp; &nbsp;match zero or one of previous class &nbsp;(NOT group)<br>
&nbsp; ^... &nbsp; if at pat[1], match only beggining of text<br>
&nbsp; ...$ &nbsp; if at pat[#pat], match only end of text<br>
&nbsp; %1-9 &nbsp; matches the previously matched group index EXACTLY
</div></li>
  <li><span class=code>string.match(subj, pat, index=1) -&gt; ...groups</span>
  Return the capture groups of pat or the whole match if no capture groups.
  index: where to start the search and can be negative.
  
  See also: string.find.</li>
  <li><span class=code>string.gmatch(subj, pat, index=1) -&gt; iterator()</span>
  Return an iterator function that when called returns the next capture group.
  index: where to start the search and can be negative.
  
  See also: string.find.</li>
  <li><span class=code>string.sub(subj, si, ei) -&gt; str[si:ei]</span>
  Return substring by index. <span class=code>("1234"):sub(3,4) == "34"</span>
  
  <div class=info>Note: This is confusingly named considering string.gsub uses pattern
  matching. Such is life.</div></li>
  <li><span class=code>string.gsub(subj, pat, repl, index=1) -&gt; string</span>
  Substittue all matches of pattern with repl, returning the new string.
  
  <span class=code>repl</span> can be a: <ul>
    <li>string: replace with the string except <span class=code>%1-9</span> will be
    a matched group from <span class=code>pat</span> and <span class=code>%%</span> is a literal <span class=code>%</span>.</li>
    <li>table: the table will be queried for every match using
    the first capture as key.</li>
    <li><span class=code>function(...matches) -&gt; string</span>: the function will be called
    with all match groups for each match.</li>
  </ul>
  
  See also: string.find for pattern documentation.</li>
  <li><span class=code>string.format(fmt: str, ...) -&gt; str</span>
  Format values into a fmt string, i.e: <span class=code>format('%s: %i', 'age', 42)</span>
  
  Directives: <div class=table><table>
    <tr>
      <td><span class=code>%%</span></td>
      <td>literal % char</td>
    </tr>
    <tr>
      <td><span class=code>%d</span></td>
      <td>decimal</td>
    </tr>
    <tr>
      <td><span class=code>%o</span></td>
      <td>octal</td>
    </tr>
    <tr>
      <td><span class=code>%x</span></td>
      <td>hexidecimal (%X uppercase)</td>
    </tr>
    <tr>
      <td><span class=code>%f</span></td>
      <td>floating point</td>
    </tr>
    <tr>
      <td><span class=code>%s</span></td>
      <td>string</td>
    </tr>
  </table></div>
  
  Directive control structure (ignore spaces): <div class=code-block>&nbsp; &nbsp; % (specifier width)? directive<br>
&nbsp; 
</div>
  
  Where <span class=code>width</span> is an integer and <span class=code>specifier</span> can be one of <div class=table><table>
    <tr>
      <td><span class=code>+</span></td>
      <td>right justify to width (the default)</td>
    </tr>
    <tr>
      <td><span class=code>-</span></td>
      <td>left justify to width</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;</span></td>
      <td>prefix a positive number with a space</td>
    </tr>
    <tr>
      <td><span class=code>#</span></td>
      <td>prefix o, x or X directives with 0, 0x and 0X respectively</td>
    </tr>
    <tr>
      <td><span class=code>0</span></td>
      <td>left-pad a number with zeros</td>
    </tr>
  </table></div>
  
  Examples: <div class=code-block>&nbsp; &nbsp; sfmt = string.format<br>
&nbsp; &nbsp; T.eq('age: 42', &nbsp; &nbsp;sfmt('%s: %i', &nbsp; 'age', 42))<br>
&nbsp; &nbsp; T.eq('age: &nbsp; &nbsp;42', sfmt('%s: %5i', &nbsp;'age', 42))<br>
&nbsp; &nbsp; T.eq('age: 42 &nbsp; ', &nbsp; &nbsp; sfmt('%s: %-5i', 'age', 42))<br>
&nbsp; &nbsp; T.eq('age: 00042', sfmt('%s: %05i', 'age', 42)<br>
&nbsp; 
</div></li>
  <li><span class=code>string.byte(str, si=1, ei=si) -&gt; ...ints</span>
  Get ASCII (integer) codes for <span class=code>s[si:ei]</span>
  
  Example: <span class=code>T.eq({98, 99}, {string.byte('abcd', 2, 3)})</span></li>
  <li><span class=code>string.char(c1, c2, ...) -&gt; string</span>
  convert character codes to string and concatenate</li>
  <li><span class=code>string.rep()</span>
  repeat str n times with separator</li>
  <li><span class=code>string.pack()</span>
  pack the values as bytes into the string using the strtys.
  
  strtys is a string of the form: <div class=table><table>
    <tr>
      <td><span class=code>&nbsp;&lt; &nbsp;&gt; &nbsp;=</span></td>
      <td>(start only) little / big / native endian</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;!# &nbsp; &nbsp; </span></td>
      <td>(start only) max alignment = <span class=code>#</span> bytes</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;b B &nbsp; &nbsp;</span></td>
      <td>signed / unsigned byte</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;h H l L</span></td>
      <td>native short(h) and long(l) + unsigned vers</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;i# I# &nbsp;</span></td>
      <td>signed/unsigned int with <span class=code>#</span> bytes</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;f d &nbsp; &nbsp;</span></td>
      <td>native float / double</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;T &nbsp; &nbsp; &nbsp;</span></td>
      <td>size_t</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;c# &nbsp; &nbsp; </span></td>
      <td>fixed-sized string of <span class=code>#</span> bytes (unaligned)</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;z &nbsp; &nbsp; &nbsp;</span></td>
      <td>zero-terminated string        (unaligned)</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;s# &nbsp; &nbsp; </span></td>
      <td>counted string of size <span class=code>#</span> bytes</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;x &nbsp; &nbsp; &nbsp;</span></td>
      <td>one byte of padding</td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;Xo &nbsp; &nbsp; </span></td>
      <td>align to option <span class=code>o</span>, i.e. <span class=code>Xi4</span></td>
    </tr>
    <tr>
      <td><span class=code>&nbsp;j J n &nbsp;</span></td>
      <td>lua Integer / Unsigned / Number</td>
    </tr>
  </table></div>
  
  Example: <div class=code-block>&nbsp; T.eq(string.pack('&gt;i2i2', 0x1234, 0x5678) == '\x12\x34\x56\x78')]<br>
&nbsp; 
</div></li>
  <li><span class=code>string.unpack()</span>
  See string.pack for the fmt</li>
  <li><span class=code>string.packsize()</span>
  Get the size which is used by strtys.</li>
  <li><span class=code>string.lower()</span>
  not documented: see <span class=code>string</span> module</li>
  <li><span class=code>string.reverse()</span>
  not documented: see <span class=code>string</span> module</li>
  <li><span class=code>string.dump()</span>
  not documented: see <span class=code>string</span> module</li>
  <li><span class=code>string.upper()</span>
  not documented: see <span class=code>string</span> module</li>
  <li><span class=code>string.len()</span>
  not documented: see <span class=code>string</span> module</li>
  <li><span class=code>table.update(to, from) -&gt; to</span>
  update to with from, return to.
  
  Note: this is an addon from metaty.</li>
  <li><span class=code>table.concat(t, sep='') -&gt; string</span>
  concatenate a table of strings with optional separator.
  
  Examples: <div class=code-block>&nbsp; concat = table.concat<br>
&nbsp; T.eq(1..' = '..3, concat{1, ' = ', 3})<br>
&nbsp; T.eq('1, 2, 3', &nbsp; concat({1, 2, 3}, ', ')<br>
&nbsp; 
</div></li>
  <li><span class=code>table.remove(t, index=#table) -&gt; t[index]</span>
  remove an item from a table, returning it.
  The table is shifted if index < #table which may cost up to O(n)</li>
  <li><span class=code>table.sort(list, cmp=lt) -&gt; nil</span>
  sort a table in place using a comparison function <span class=code>cmp</span> who's behavior
  must be: <span class=code>cmp(a, b) --&gt; makeAFirst</span></li>
  <li><span class=code>table.insert()</span>
  insert or push to table (list-like)
  
  Example: <div class=code-block>&nbsp; local push = table.insert<br>
&nbsp; local t = {}<br>
&nbsp; <br>
&nbsp; -- push/append behavior<br>
&nbsp; push(t, 'd') &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- {'d'<br>
&nbsp; push(t, 'e') &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- {'d', 'e'}<br>
&nbsp; <br>
&nbsp; -- insert behavior<br>
&nbsp; table.insert(t, 'b', 1) -- {'b', 'd', 'e'}<br>
&nbsp; table.insert(t, 'c', 2) -- {'b', 'c', 'd', 'e'}<br>
&nbsp; T.eq({'b', 'c', 'd', 'e'}, t)<br>
&nbsp; 
</div></li>
  <li><span class=code>table.move()</span>
  Move values from one list to another.
  Note that <span class=code>si=startIndex</span> and <span class=code>ei=endIndex</span> (inclusive).
  
  Equivalent to the following, though done in a way
  that will properly handle overlapping data: <div class=code-block>&nbsp; ti = siTo<br>
&nbsp; for fi=siFrom,eiFrom do<br>
&nbsp; &nbsp; to[ti] = from[fi]; ti = ti + 1<br>
&nbsp; end<br>
&nbsp; 
</div></li>
  <li><span class=code>io.popen()</span>
  Execute shell command in separate process.
  
  See also: <ul>
    <li><span class=code>os.execute()</span>: docs on file:close()</li>
    <li><a href="lib/civix">lib/civix</a><span class=code>.sh()</span>: ergonomic blocking shell.</li>
  </ul></li>
  <li><span class=code>io.type()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.open()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.input()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.close()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.lines()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.output()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.flush()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.write()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.read()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>io.tmpfile()</span>
  not documented: see <span class=code>io</span> module</li>
  <li><span class=code>os.execute(string) -&gt; (ok, "exit", rc)</span>
  Execute shell command via C's `system` API. Returns: <ul>
    <li>ok:      true on command success, false if rc>0</li>
    <li>"exit":  always literal "exit" if command completed</li>
    <li>rc:      the return code of the command</li>
  </ul>
  <div class=code-block>&nbsp; os.execute'shell command' -&gt; (ok, "exit", rc)<br>
&nbsp; os.execute() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; isShellAvailable
</div>
  
  Prints whatever was executed. There are no ways to
  redirect the output besides piping in the command
  string itself.
  
  Recommendation:
  For all but the simplest cases use io.popen instead</li>
  <li><span class=code>os.clock()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>os.exit()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>os.remove(path) -&gt; nil</span>
  remove file.</li>
  <li><span class=code>os.getenv()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>os.tmpname()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>os.rename()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>os.time()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>os.date()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>os.difftime()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>os.setlocale()</span>
  not documented: see <span class=code>os</span> module</li>
  <li><span class=code>math.type(v) -&gt; ("float" | "integer" | nil)</span></li>
  <li><span class=code>math.max(x, ...) -&gt; max according to [$&lt;]</span></li>
  <li><span class=code>math.min(x, ...) -&gt; min according to [$&lt;]</span></li>
  <li><span class=code>math.cos(x) -&gt; cos(x) in radians</span></li>
  <li><span class=code>math.sin(x) -&gt; sin(x) in radians</span></li>
  <li><span class=code>math.tan(x) -&gt; tan(x) in radians</span></li>
  <li><span class=code>math.acos(x) -&gt; arccos(x) in radians</span></li>
  <li><span class=code>math.asin(x) -&gt; arcsin(x) in radians</span></li>
  <li><span class=code>math.atan2(n, d) -&gt; arctan(n / d) in radians</span></li>
  <li><span class=code>math.exp(x) -&gt; e^x (where e is the natural log base)</span></li>
  <li><span class=code>math.ceil()</span>
  currently not documented</li>
  <li><span class=code>math.atan2(n, d) -&gt; arctan(n / d) in radians</span></li>
  <li><span class=code>math.tointeger()</span>
  currently not documented</li>
  <li><span class=code>math.ult()</span>
  currently not documented</li>
  <li><span class=code>math.log10()</span>
  currently not documented</li>
  <li><span class=code>math.random()</span>
  currently not documented</li>
  <li><span class=code>math.sinh()</span>
  currently not documented</li>
  <li><span class=code>math.cosh()</span>
  currently not documented</li>
  <li><span class=code>math.tanh()</span>
  currently not documented</li>
  <li><span class=code>math.modf()</span>
  currently not documented</li>
  <li><span class=code>math.frexp()</span>
  currently not documented</li>
  <li><span class=code>math.floor()</span>
  currently not documented</li>
  <li><span class=code>math.randomseed()</span>
  currently not documented</li>
  <li><span class=code>math.rad()</span>
  currently not documented</li>
  <li><span class=code>math.deg()</span>
  currently not documented</li>
  <li><span class=code>math.fmod()</span>
  currently not documented</li>
  <li><span class=code>math.ldexp()</span>
  currently not documented</li>
  <li><span class=code>math.log()</span>
  currently not documented</li>
  <li><span class=code>math.pow()</span>
  currently not documented</li>
  <li><span class=code>math.sqrt()</span>
  currently not documented</li>
  <li><span class=code>math.abs()</span>
  currently not documented</li>
  <li><span class=code>for()</span>
  for is a looping construct with two forms:
  
  Numeric: <div class=code-block>&nbsp; &nbsp; for i=si,ei,period do -- period=1 by default<br>
&nbsp; &nbsp; &nbsp; ... do something with i<br>
&nbsp; &nbsp; end<br>
&nbsp; <br>
&nbsp; &nbsp; -- is basically the same as<br>
&nbsp; &nbsp; local i = si<br>
&nbsp; &nbsp; while i &lt;= ei do i = i + si<br>
&nbsp; &nbsp; &nbsp; ... do something with i<br>
&nbsp; &nbsp; end<br>
&nbsp; 
</div>
  
  Generic: <div class=code-block>&nbsp; &nbsp; for i, v, etc in (nextfn, state, _index) do<br>
&nbsp; &nbsp; &nbsp; .. do something with i, v, ...<br>
&nbsp; &nbsp; end<br>
&nbsp; <br>
&nbsp; &nbsp; -- is almost the same as<br>
&nbsp; &nbsp; while true do<br>
&nbsp; &nbsp; &nbsp; local i, v, etc = nextfn(state, _index)<br>
&nbsp; &nbsp; &nbsp; if i == nil then break end<br>
&nbsp; &nbsp; &nbsp; _index = i -- note: C internal, _index from lua doesn't change<br>
&nbsp; &nbsp; &nbsp; ... code using i, v, etc here<br>
&nbsp; &nbsp; end<br>
&nbsp; 
</div>
  
  The goal in writing a stateless iterator function is to match this
  loop's API as much as possible.
  
  Example rewriting ipairs: <div class=code-block>&nbsp; &nbsp; local function rawipairs(t, i)<br>
&nbsp; &nbsp; &nbsp; i = i + 1<br>
&nbsp; &nbsp; &nbsp; if i &gt; #t then return nil end<br>
&nbsp; &nbsp; &nbsp; return i, t[i]<br>
&nbsp; &nbsp; end<br>
&nbsp; &nbsp; local function myipairs_(t)<br>
&nbsp; &nbsp; &nbsp; return rawipairs, t, 0<br>
&nbsp; &nbsp; end<br>
&nbsp; &nbsp; for i, v in myipairs{5, 6, 7} do<br>
&nbsp; &nbsp; &nbsp; iterates through (1, 5) -&gt; (2, 6) -&gt; (3, 7)<br>
&nbsp; &nbsp; end<br>
&nbsp; 
</div>
  
  Example rewriting pairs using <span class=code>next(t, key)</span>: <div class=code-block>&nbsp; &nbsp; function mypairs(t)<br>
&nbsp; &nbsp; &nbsp; return next, t, nil<br>
&nbsp; &nbsp; end<br>
&nbsp; &nbsp; for k, v in mypairs{a=1, b=2, c=3} do<br>
&nbsp; &nbsp; &nbsp; iterates through ('a', 1) -&gt; ('b', 2) -&gt; ('c', 3)<br>
&nbsp; &nbsp; end<br>
&nbsp; 
</div>
  
  See also: metaty.split is a more complex example.</li>
</ul>
<p>
</div></body>
</html>
